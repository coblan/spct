{% extends "f7/base.html" %} {% load static %} {% load jsonify %} {% block page_content %}
<!--<script src="{% static 'lib/fingerprint2.min.js' %}"></script>-->

<style type="text/css">
    body,
    html,
    #container {
        height: 100vh;
        width: 100%;
        margin: 0px;
    }
</style>

<script>
    //    ff.pop_menu(function(){
    //        var buttons = [
    //            {
    //                text: '打卡',
    //                onClick: function () {
    //                    geolocation.getCurrentPosition(function(status,result){
    //                        if(status=='complete'){
    //                            var pos=result.position
    //                            geocoder.getAddress([pos.lng,pos.lat], function(status, result_coder) {
    //                                if (status === 'complete' && result_coder.info === 'OK') {
    //
    //                                    pos.addr=result_coder.regeocode.formattedAddress
    //
    ////                                    alert()
    ////                                    //获得了有效的地址信息:
    ////                                    //即，result.regeocode.formattedAddress
    //                                }else{
    //                                    //获取地址失败
    //                                }
    //
    //                                var post_data=[{fun:'daka',pos:pos,device:fingerprint }]
    //                                ex.post('/_ajax/'+app,JSON.stringify(post_data),function(resp){
    //                                    if(resp.daka.status=='success'){
    //                                        alert('打卡成功')
    //                                    }
    //                                })
    //                            });
    //
    //
    //
    //                        }else{
    //                            alert('open gps')
    //                        }
    //                    })
    //                }
    //            },
    //            {
    //                text: '打卡记录',
    //                onClick: function () {
    //                    var url=engine_url+'/map_daka.dakarecord.f7'
    //                  ff.load(url,'map_daka.dakarecord.f7')
    //                }
    //            },
    //
    //        ];
    //
    //
    //        buttons.push({
    //            text: '取消',
    //            color: 'red',
    //        })
    //        ff.app.actions(buttons)
    //    })

    //
    //    fingerprint=''
    //    $(function(){
    //        setTimeout(function() {
    //            var fp = new Fingerprint2();
    //            fp.get(function (result, components) {
    //                        fingerprint=result
    //                })
    //        })
    //    })


    var mypos = [104.071756, 30.666209]
        //        function showPosition(position)
        //        {
        //            alert(position)
        //        }
        //
        //        function getLocation()
        //        {
        //            if (navigator.geolocation)
        //            {//getCurrentPosition
        //                navigator.geolocation.watchPosition(function(s){
        //                    mypos = [s.coords.longitude,s.coords.latitude ]
        //                    alert(mypos)
        //                },function(e){
        //                    alert(e.message)
        //                });
        //            }
        //            else{alert("Geolocation is not supported by this browser.");}
        //        }


    //getLocation()




    //    $(function(){
    //        new  Vue({
    //            el:'#control',
    //            methods:{
    //                goto_orgin:function(){
    //
    //                    map.setCenter(mypos);
    //                    this.pos_marker(mypos)
    //                },
    //                new_marker:function(){
    //                    var content=$('.fuck')[0]
    //                    var marker = new AMap.Marker({
    //                        position: [116.480983, 39.989628],//marker所在的位置
    //                        map:map,//创建时直接赋予map属性
    //                        title:'这时一坨屎',
    //                        content:content
    //                    });
    //                },
    //                pos_marker:function(pos){
    //                    var content=$('.fuck')[0]
    //                    var marker = new AMap.Marker({
    //                        position: pos,//marker所在的位置
    //                        map:map,//创建时直接赋予map属性
    //                        title:'这时一坨屎',
    //                        content:content
    //                    });
    //                }
    //            }
    //        })
    //    })
</script>

<!--<div id="control">-->
<!--<button @click="goto_orgin()">sss</button>-->
<!--<button @click="new_marker()">set mark</button>-->
<!--</div>-->

<!--<div class="fuck"></div>-->

<div id="container" tabindex="0"></div>

<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.3&key=0909294a753dfe00a0aa124b6ecb93eb"></script>

<script type="text/javascript">
    var search_args = ex.parseSearch()
    center = [search_args.lng, search_args.lat]
    var map = new AMap.Map('container', {
        resizeEnable: true,
        zoom: 15,
        center: center,
    });

    marker = new AMap.Marker({
        position: center,
    });
    marker.setMap(map);

    //    map.setMapStyle('amap://styles/darkblue');
    //    map.setFeatures(['road','point'])//多个种类要素显示
    AMap.plugin(['AMap.ToolBar', 'AMap.AdvancedInfoWindow'], function() {
        //创建并添加工具条控件
        var toolbar = new AMap.ToolBar();
        map.addControl(toolbar);
        //创建高级信息窗体并在指定位置打开
        //        var infowindow = new AMap.AdvancedInfoWindow({
        //            content: '<div class="info-title">高德地图</div><div class="info-content">'+
        //            '<img src="http://webapi.amap.com/images/amap.jpg">'+
        //            '高德是中国领先的数字地图内容、导航和位置服务解决方案提供商。<br>'+
        //            '<a target="_blank" href="http://mobile.amap.com/">点击下载高德地图</a></div>',
        //            offset: new AMap.Pixel(0, -30)
        //        });
        //        infowindow.open(map,[116.480983, 39.989628]);
    })

    //    AMap.plugin('AMap.Driving',function(){
    //        var drving = new AMap.Driving({
    //            map:map
    //        })
    //        drving.search([
    //            {keyword:'北京西站',city:'北京'},
    //            {keyword:'高德地图',city:'北京'}
    //        ],function(status, result){
    //            alert(result)
    //        });
    //    })


    //    mapObj = new AMap.Map('iCenter');
    map.plugin('AMap.Geolocation', function() {
        geolocation = new AMap.Geolocation({
            enableHighAccuracy: true, //是否使用高精度定位，默认:true
            timeout: 15000, //超过10秒后停止定位，默认：无穷大
            maximumAge: 0, //定位结果缓存0毫秒，默认：0
            convert: true, //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
            showButton: true, //显示定位按钮，默认：true
            buttonPosition: 'LB', //定位按钮停靠位置，默认：'LB'，左下角
            buttonOffset: new AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            showMarker: true, //定位成功后在定位到的位置显示点标记，默认：true
            showCircle: true, //定位成功后用圆圈表示定位精度范围，默认：true
            panToLocation: true, //定位成功后将定位到的位置作为地图中心点，默认：true
            zoomToAccuracy: true //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
        });
        map.addControl(geolocation);
        //        geolocation.getCurrentPosition();
        AMap.event.addListener(geolocation, 'complete', function(s) {
            console.log(s.message)
        }); //返回定位信息
        AMap.event.addListener(geolocation, 'error', function(e) {
            alert(e.message)
        }); //返回定位出错信息

    });


    //    AMap.service('AMap.Geocoder',function(){//回调函数
    //        //实例化Geocoder
    //        geocoder = new AMap.Geocoder({
    //            city: "010"//城市，默认：“全国”
    //        });
    //        //TODO: 使用geocoder 对象完成相关功能
    //    })

    //    var lnglatXY=[116.396574, 39.992706];//地图上所标点的坐标
    //    geocoder.getAddress(lnglatXY, function(status, result) {
    //        if (status === 'complete' && result.info === 'OK') {
    //            alert(result.regeocode.formattedAddress)
    //            //获得了有效的地址信息:
    //            //即，result.regeocode.formattedAddress
    //        }else{
    //            //获取地址失败
    //        }
    //    });


    var old_marker = []

    function set_marker(ls) {
        ex.each(old_marker, function(marker) {
            map.remove(marker)
        })
        ex.each(ls, function(pos) {
            marker = new AMap.Marker({
                position: pos,
            });
            marker.setMap(map);
            old_marker.push(marker)
        })

    }
</script>

<style>
    /*#container {width:600px; height: 300px; }*/
    
    .fuck {
        width: 10px;
        height: 10px;
        border-radius: 5px;
        background-color: green;
    }
    
    .fuck:hover {
        background-color: red;
        width: 20px;
        height: 20px;
        border-radius: 10px;
        position: relative;
        top: -5px;
        left: -5px;
    }
</style>

{% endblock %}