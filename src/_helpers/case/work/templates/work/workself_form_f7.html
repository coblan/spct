{% extends "work/workrecord_form_f7.html" %}


{% block extra_script %}
<script>

    ex_logic={
        methods:{
            submit: function submit() {
                var self = this;
                if (window.bus) {
                    window.bus.$emit('sync_data');
                }
                show_upload();
                var search = ex.parseSearch();
                var post_data = [{ fun: 'save_workself', row: this.kw.row }];
                var url = ex.appendSearch('/_ajax/work', search_args);
                ex.post(url, JSON.stringify(post_data), function (resp) {
                    hide_upload(500);

                    if (resp.save_workself.errors) {
                        self.kw.errors = resp.save_workself.errors;
                    }else if(parent.back) {
                        var new_row=resp.save_workself.row
                        ff.back(function(win){
                            if(self.kw.row.pk){
                                var row = ex.findone(win.rows,{pk:new_row.pk})
                                ex.assign(row,new_row)
                                row.work=new_row._work_label
                            }else{
                                win.location.reload()
                            }

                        })
                    }
                });
            },
        }
    }

    form_logic.mixins=[field_fun,ex_logic]
</script>
{% endblock %}