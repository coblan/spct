{% extends "wx/base.html" %}
{% load static %}
{% load jsonify %}

{% block page_content %}
<script src='{% static "js/table.pack.js" %}'></script>
<script type="text/javascript">


    tabs={{ tabs | jsonify | default:'[]' }}
    crt_tab = '{{ crt_tab | default:'null' }}'
    crt_tab = crt_tab || tabs[0].name

    permits={{ permits | jsonify | default:'[]' }}
    groups={{ groups | jsonify | default:'[]' }}

    ex.each(permits,function(permit){
        permit.groups = ex.map(permit.groups,function(group){
            return ex.findone(groups,{pk:group.pk})
        })
    })

    form_logic={
        el:'#there',
        data:{
            tabs:tabs,
            crt_tab:crt_tab,

            permits:permits,
            groups:groups
        },
        mixins:[field_fun],
        methods:{
            item_link:function(name){
                if(name!=this.crt_tab){
                    return ex.appendSearch({_tab:name})
                }else{
                    return 'javascript:;'
                }
            },
            submit:function () {
                var self =this;

                show_upload()
                var search =ex.parseSearch()
                var post_data=[{fun:'save_workpermit',permits:this.permits,emp_pk:this.search_args.pk}]
                ex.post('/_ajax/'+app,JSON.stringify(post_data),function (resp) {
                    hide_upload(500)
//                    if( resp.save_workpermit.errors){
//                        self.kw.errors = resp.save.errors
//                    }else if(search._pop==1){
//                        window.ln.try_rt({row:resp.save.row})
//                    }else if(search.next){
//                        location=decodeURIComponent(search.next)
//                    }else{
//                        self.after_sub()
//                    }
                })
            },
        }
    }

    $(function () {
        new Vue(form_logic)
    })
</script>

{% block extra_head %}

{% endblock %}

<div id='there'>

    <!--<div v-if="can_log" style='float: right;padding: 5px 20px;'>-->
        <!--<a :href="log_url()">History</a>-->
    <!--</div>-->
    <!--<path-nav :menu='menu'>-->
        <!--<li><span>编辑</span></li>-->
    <!--</path-nav>-->

    <div  style="text-align: center;margin:1em 0;">
        <div class="btn-group" role="group" aria-label="..." >
            <a type="button" :class="['btn btn-default',{'btn-info':crt_tab==tab.name}]" v-for="tab in tabs" :href="item_link(tab.name)" v-text="tab.label">Left</a>
        </div>
    </div>

    <!--<div class="flex">-->
        <!--<ul class="nav nav-tabs tabs flex-grow">-->
            <!--<li v-for="tab in tabs" :class="{'active':crt_tab==tab.name}"><a :href="item_link(tab.name)" v-text="tab.label" ></a></li>-->

        <!--</ul>-->

        <!--<com-form-btn :submit="submit" :del_row="del_row" :cancel="cancel"></com-form-btn>-->

    <!--</div>-->


    <table class="table fake-suit">
        <thead>
        <tr>
            <th>权限组</th>
            <th v-for="permit in permits" v-text="permit.depart._label"></th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="group in groups">
            <td v-text="group._label"></td>
            <td v-for="permit in permits">
                <input type="checkbox" :value="group" v-model="permit.groups"/>
            </td>
        </tr>
        </tbody>

    </table>

    <!--<div class='field-panel'>-->

    <!--<field  v-for='head in kw.heads' :key="head.name" :name='head.name' :kw='kw'></field>-->
    <!--</div>-->

    <div v-btn-group>
        <a v-if="can_edit" state="success"  @click="submit()">确定</a>
    </div>


    {% block extra_body %}

    {% endblock %}
</div>

<style type="text/css">
    .tabs{
        align-items: center;
    }
    .tabs li:first-child{
        margin-left: 15px;
    }
    .tabs li{
        display: inline-block;
        margin-left:5px;
        vertical-align: bottom;
    }

    .nav.tabs>li>a{
        padding: 8px 18px 5px 18px;
        background-color: #f6f7f8;
        border: 1px solid #dddddd;
        border-bottom: none;
        position: relative;
        margin-bottom: 1px;
        font-weight: 400;
    }
    .nav li>a:hover{
        text-underline: blue;
        text-decoration: underline;
    }

    .nav li.active>a:after{
        content: ' ';
        position: absolute;
        width: 100%;
        height: 4px;
        bottom: -4px;
        left: 0;
        background-color: #eee;
    }
    .nav li.active a{
        text-decoration: none;
        background-color: #eeeeee;
        font-weight: 500;
    }
    .nav li.active a:hover{
        border-bottom: none;
        text-decoration: none;
        color: #a2a2a2;
        font-weight: 500;
        background-color: #eeeeee;
    }
</style>

{% endblock %}